/***
—хема Ѕƒ состоит из четырех отношений:
Company (ID_comp, name)
Trip(trip_no, ID_comp, plane, town_from, town_to, time_out, time_in)
Passenger(ID_psg, name)
Pass_in_trip(trip_no, date, ID_psg, place)
“аблица Company содержит идентификатор и название компании, осуществл€ющей перевозку пассажиров. “аблица Trip содержит информацию о рейсах: номер рейса, идентификатор компании, тип самолета, город отправлени€, город прибыти€, врем€ отправлени€ и врем€ прибыти€. “аблица Passenger содержит идентификатор и им€ пассажира. “аблица Pass_in_trip содержит информацию о полетах: номер рейса, дата вылета (день), идентификатор пассажира и место, на котором он сидел во врем€ полета. ѕри этом следует иметь в виду, что
- рейсы выполн€ютс€ ежедневно, а длительность полета любого рейса менее суток; town_from <> town_to;
- врем€ и дата учитываетс€ относительно одного часового по€са;
- врем€ отправлени€ и прибыти€ указываетс€ с точностью до минуты;
- среди пассажиров могут быть однофамильцы (одинаковые значени€ пол€ name, например, Bruce Willis);
- номер места в салоне Ц это число с буквой; число определ€ет номер р€да, буква (a Ц d) Ц место в р€ду слева направо в алфавитном пор€дке;
- св€зи и ограничени€ показаны на схеме данных.***/

/***
«адание: 76 (Serge I: 2003-08-28)
ќпределить врем€, проведенное в полетах, дл€ пассажиров, летавших всегда на разных местах. ¬ывод: им€ пассажира, врем€ в минутах.

WITH dsPsg AS
(SELECT pt.Id_psg id
FROM Pass_in_trip pt, Trip t
WHERE t.trip_no = pt.trip_no 
GROUP BY pt.Id_psg
HAVING COUNT(DISTINCT pt.place) = COUNT(pt.place)
),
dsTime AS
(SELECT pt.Id_psg id, 
        sum(DATEDIFF(minute, time_out, DATEADD(DAY,IIF(time_in<time_out,1,0)
                     ,time_in))
           ) dur 
 FROM Pass_in_trip pt, Trip t
 WHERE t.trip_no = pt.trip_no 
 GROUP BY pt.Id_psg
)
SELECT p.name, dsTime.dur
FROM dsPsg, Passenger p, dsTime
WHERE p.ID_psg = dsPsg.id and
      dsTime.id = p.ID_psg

«адание: 77 (Serge I: 2003-04-09)
ќпределить дни, когда было выполнено максимальное число рейсов из
–остова ('Rostov'). ¬ывод: число рейсов, дата.
WITH dsT AS
(SELECT p.trip_no, p.date
FROM Pass_in_trip p
GROUP BY  p.trip_no, p.date
),
dsS as 
(SELECT COUNT(dsT.trip_no) max
FROM Trip t, dsT 
WHERE t.trip_no = dsT.trip_no and
      t.town_from = 'Rostov'
GROUP BY  dsT.date
)
SELECT COUNT(dsT.trip_no), dsT.date
FROM Trip t, dsT 
WHERE t.trip_no = dsT.trip_no and
      t.town_from = 'Rostov'
GROUP BY  dsT.date
HAVING COUNT(dsT.trip_no) =(SELECT max(dsS.max)
FROM dsS)


***/
